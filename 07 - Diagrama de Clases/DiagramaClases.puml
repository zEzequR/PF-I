@startuml CLASES
left to right direction
skinparam classAttributeIconSize 0

' ----------------- PERSONAS -----------------
class Persona {
    - nombre
    - email
    - numTel
    - direccion

    + actualizarContacto(dni, email, numTel, direccion)    
    + getNombre()
    + setNombre(nombre)
    + getEmail()
    + setEmail(email)
    + getNumTel()
    + setNumTel(numTel)
    + getDireccion()
    + setDireccion(direccion)
}

class PersonaFisica {
    - DNI
    + getDNI()
    + setDNI(dni)
}
class PersonaJuridica {
    - CUIT
    + getCUIT()
    + setCUIT(cuit)
}

Persona <|-- PersonaFisica
Persona <|-- PersonaJuridica

' ----------------- USUARIO / EMPLEADO -----------------
class Usuario {
    - nombreUsuario
    - contraseña
    
    + getNombreUsuario()
    + setNombreUsuario(nombreUsuario)
    + getContraseña()
    + setContraseña(contraseña)
}

class Empleado {
    - legajo
    - sueldo

    + getLejago()
    + setLegajo(legajo)
    + getSueldo()
    + setSueldo(sueldo)
    + aplicarDescuentoEmpleado()
}

Empleado -- Usuario
Empleado -- Asistencia

enum TipoUsuario {
    Administrador
    Farmaceutico
}
Usuario -- TipoUsuario

' ----------------- ASISTENCIA -----------------
class Asistencia {
    - fecha
    - horaEntrada
    - horaSalida
    - estado

    + registrarAsistencia(nombreUsuario, fecha, horaEntrada, horaSalida, estado)

    + getFecha()
    + setFecha(fecha)
    + getHoraEntrada()
    + setHoraEntrada(horaEntrada)
    + getHoraSalida()
    + setHoraSalida(horaSalida)
    + getEstado()
    + setEstado(estado)
}
enum EstadoAsistencia {
    Licencia
    Ausente
    Presente
    Tarde
}
Asistencia -- EstadoAsistencia
Empleado -- Asistencia

' ----------------- CLIENTE -----------------
class Cliente {
    - DNI
    - nombre
    - SaldoCtaCorriente
    - tipoCliente
    - montoAcumulado
    - email
    - numTel

    + getCliente(dni)
    + getDNI()
    + setDNI(dni)
    + getNombre()
    + setNombre(nombre)
    + getSaldoCtaCorriente()
    + setSaldoCtaCorriente(saldo)
    + getTipoCliente()
    + setTipoCliente(tipo)
    + getMontoAcumulado()
    + setMontoAcumulado(monto)
    + getEmail()
    + setEmail(email)
    + getNumTel()
    + setNumTel(numTel)
    + registrarPagoCuentaCorriente(dni, monto)
    + esFrecuente(dni)
}
PersonaFisica <|-- Cliente
PersonaFisica <|-- Empleado
PersonaFisica <|-- Medico
' ----------------- MEDICO / RECETA -----------------
class Medico {
    - matriculaMed
    - nombreMedico

    + getMatriculaMed()
    + setMatriculaMed(matricula)
    + getNombreMedico()
    + setNombreMedico(nombre)
}
class Receta {
    - nroReceta
    - fechaPrescripcion
    - fechaValidez
    - tipoReceta
    - obraSocialNombre
    
    + validarReceta(nroReceta)
    + getNroReceta()
    + setNroReceta(nro)
    + getFechaPrescripcion()
    + setFechaPrescripcion(fecha)
    + getFechaValidez()
    + setFechaValidez(fecha)
    + getTipoReceta()
    + setTipoReceta(tipo)
    + getObraSocialNombre()
    + setObraSocialNombre(nombre)
}
class DetalleReceta {
    - fechaPrescripcion
    - productosRecetados
    
    + getFechaPrescripcion()
    + setFechaPrescripcion(fecha)
    + getProductosRecetados()
    + setProductosRecetados(productos)
}
Medico -- Receta
Receta *-- DetalleReceta
Cliente -- Receta

' ----------------- OBRA SOCIAL / COBERTURA -----------------
class ObraSocial {
    - nombreObraSocial
    - contacto

    + getObraSocial(nombre)
    
    ' Getters y Setters agregados
    + getNombreObraSocial()
    + setNombreObraSocial(nombre)
    + getContacto()
    + setContacto(contacto)
}
class Cobertura {
    - numAfiliado
    - descuentoPorcentaje
    
    + getNumAfiliado()
    + setNumAfiliado(num)
    + getDescuentoPorcentaje()
    + setDescuentoPorcentaje(porcentaje)
}
Cliente -- Cobertura
Cobertura -- ObraSocial

' ----------------- MEDICAMENTO / DROGUERIA -----------------
class Medicamento {
    - codigoBarra
    - nombre
    - precioUnitario
    - requiereReceta
    - controlado
    - cadenaFrio
    - stock
    - stockMinimo
    - drogueriaNombre

    + consultarStock()
    + disminuirStock(cantidad)
    + aumentarStock(cantidad)
    + estaPorDebajoStockMinimo()
    + getCodigoBarra()
    + setCodigoBarra(codigo)
    + getNombre()
    + setNombre(nombre)
    + getPrecioUnitario()
    + setPrecioUnitario(precio)
    + getRequiereReceta()
    + setRequiereReceta(booleano)
    + getControlado()
    + setControlado(booleano)
    + getCadenaFrio()
    + setCadenaFrio(booleano)
    + getStock()
    + setStock(cantidad)
    + getStockMinimo()
    + setStockMinimo(cantidad)
    + getDrogueriaNombre()
    + setDrogueriaNombre(nombre)
}
class Drogueria {
    - nombre
    - email
    - telefono
    - canalPreferido

    + actualizarContacto(nombre, email, telefono, canalPreferido)
    + getNombre()
    + setNombre(nombre)
    + getEmail()
    + setEmail(email)
    + getTelefono()
    + setTelefono(telefono)
    + getCanalPreferido()
    + setCanalPreferido(canal)
}
PersonaJuridica <|-- Drogueria
Drogueria -- Medicamento

' ----------------- VENTAS / DETALLE / PAGO / TICKET -----------------
enum TipoVenta {
    conReceta
    sinReceta
}

enum EstadoVenta {
    Pendiente
    Concretado
    Cancelado
}

class Venta {
    - nroVta
    - fechaVenta
    - tipoVta
    - total
    - clienteDNI
    - nombreUsuario
    - estadoVenta

    + generarNroVta()
    + calcularTotal()
    + cancelarVta()
    + getNroVta()
    + setNroVta(nro)
    + getFechaVenta()
    + setFechaVenta(fecha)
    + getTipoVta()
    + setTipoVta(tipo)
    + getTotal()
    + setTotal(total)
    + getClienteDNI()
    + setClienteDNI(dni)
    + getNombreUsuario()
    + setNombreUsuario(nombre)
    + getEstadoVenta()
    + setEstadoVenta(estado)
}
Venta ..> TipoVenta
Venta -- EstadoVenta

class DetalleVenta {
    - nroDetalle
    - codigoBarra
    - cantidad
    - precioUnitario
    - subtotal

    + agregarDetalle(codigoBarra, cantidad)
    + eliminarDetallePorCodigo(codigoBarra)
    + modificarCantidadDetalle(codigoBarra, nuevaCantidad)
    + calcularSubtotal(cantidad, precioUnitario)
    + actualizarCantidad(nuevaCantidad)
    + getNroDetalle()
    + setNroDetalle(nro)
    + getCodigoBarra()
    + setCodigoBarra(codigo)
    + getCantidad()
    + setCantidad(cantidad)
    + getPrecioUnitario()
    + setPrecioUnitario(precio)
    + getSubtotal()
    + setSubtotal(subtotal)
}
Venta *-- DetalleVenta
DetalleVenta -- Medicamento

class Pago {
    - numTransacción
    - tipoPago
    - monto
    - cuotas

    + asignarNumTransaccion(numTransacción)
    ' Getters y Setters agregados
    + getNumTransaccion()
    + setNumTransaccion(num)
    + getTipoPago()
    + setTipoPago(tipo)
    + getMonto()
    + setMonto(monto)
    + getCuotas()
    + setCuotas(cuotas)
    + getEstado()
    + setEstado(estado)

}
Venta -- Pago

enum estadoPago {
    aprobado
    rechazado
}
Pago -- estadoPago

class Ticket {
    - nroTicket
    - fechaHora
    - pdfPath

    + generarTicket(nroVta)
    + getPath()
    + getNroTicket()
    + setNroTicket(nro)
    + getFechaHora()
    + setFechaHora(fecha)
    + setPdfPath(path)
}

enum Estado{
    error
    creado
    enviado
}
Ticket -- Estado
Venta -- Ticket

' ----------------- TIPO DESCUENTO -----------------
class TipoDescuento {
    - motivo
    - porcentaje
    - fechaInicio
    - fechaFin
    - activo

    + esAplicable(nroVta)
    + getMotivo()
    + setMotivo(motivo)
    + getPorcentaje()
    + setPorcentaje(porcentaje)
    + getFechaInicio()
    + setFechaInicio(fecha)
    + getFechaFin()
    + setFechaFin(fecha)
    + getActivo()
    + setActivo(activo)
}
TipoDescuento -- Venta
TipoDescuento -- Cliente

' ----------------- PEDIDOS / DETALLEPEDIDO -----------------

class Pedido {
    - numPedido
    - proveedorNombre
    - fechaPedido

    + agregarLinea(codigoBarra, cantidad)
    + modificarLinea(codigoBarra, cantidad)
    + eliminarLinea(codigoBarra)
    + generarNumPedido()
    + getNumPed()
    + setNumPed()
    + setFecha()
    + setProveedor()
    + getProveedorNombre()
    + getFechaPedido()
}

enum EstadoPedido{
    error
    creado
    enviado
}

class DetallePedido {
    - codigoBarra
    - nombreMedicamento
    - cantidad

    + calcularSubtotal(cantidad, precioUnitario)
    + agregarLinea(codigoBarra, cantidad)
    + modificarLinea(codigoBarra, cantidad)
    + eliminarLinea(codigoBarra)
    + getCodigoBarra()
    + setCodigoBarra(codigo)
    + getNombreMedicamento()
    + setNombreMedicamento(nombre)
    + getCantidad()
    + setCantidad(cantidad)
}

Pedido *-- DetallePedido
Pedido -- Drogueria
Pedido -- EstadoPedido

' ----------------- CONTROLADORES / SERVICIOS -----------------
interface NegocioControlador {
    + iniciarSesion(nombreUsuario, contraseña)
    + cerrarSesion()
    + crearUsuario(nombreUsuario, contraseña, tipoUsuario)
    + modificarUsuario(nombreUsuario, campos)
    + buscarUsuarios(filtros)

    + crearCliente(dni, nombre, email, numTel, tipoCliente)
    + modificarCliente(dni, camposContacto)
    + buscarClientes(filtros)
    + abrirCuentaCorriente(dni)
    + registrarPagoCuentaCorriente(dni, monto)
    + mostrarClientes()

    + crearMedicamento(codigoBarra, nombre, precioUnitario, stock, stockMinimo, drogueriaNombre)
    + modificarMedicamento(codigoBarra, campos)
    + eliminarMedicamento(codigoBarra)
    + buscarMedicamentos(filtros)
    + ajustarStock(codigoBarra, cantidad)
    + MostrarMedicamentos()

    + crearDrogueria(nombre, email, telefono, canalPreferido)
    + modificarDrogueria(nombre, campos)
    + eliminarDrogueria(nombre)
    + buscarDroguerias(filtros)

    + crearVenta(clienteDNI, tipoVta)
    + agregarLineaVenta(nroVta, codigoBarra, cantidad)
    + editarLineaVenta(nroVta, codigoBarra, nuevaCantidad)
    + eliminarLineaVenta(nroVta, codigoBarra)
    + cancelarVenta(nroVta)
    + aplicarDescuentoVenta(nroVta, motivo)
    + finalizarVenta(nroVta, tipoPago, nroCuotas)
    + buscarVentas(filtros)
    + finalizar(tipoPago, nroCuotas)

    + crearPago(nroVta, tipoPago, monto, cuotas)
    + procesarPago(nroVta, tipoPago)
    + procesarRespuestaPosnet(estadoPago, numTransacción)
    + procesarRespuestaPago(nroVta, estadoPago, numTransacción)
    + registrarTransaccion(nroVta, numTransacción, estadoPago)
    + actualizarEstadoVenta(nroVta, estadoVenta)
    + reintentarEnvioComprobante(nroVta)
}

interface ServicioPedidos {
    + generarPedidoAutomatico()
    + crearPedidoManual(proveedorNombre, listaItems)
    + generarDetallePedido(numPedido, codigoBarra, cantidad)
    + generarPDFPedido(numPedido)
    + seleccionarCanalEnvioProveedor(proveedorNombre)
    + enviarPedido(numPedido, proveedorNombre)
    + enviarViaWhatsApp(numPedido, telefono)
    + enviarViaEmail(numPedido, email)
    + registrarEnvioPedido(numPedido, proveedorNombre, canal, estado)
    + ObtenerEstadoPedido(numPedido)
    + ReintentarDetallePedido(numPedido)

    + generarPDFTicket(nroVta)
    + enviarComprobante(nroVta, clienteDNI)
    + enviarViaWhatsAppComprobante(nroVta, telefono)
    + enviarViaEmailComprobante(nroVta, email)
    + guardarTicketLocal(nroVta)
    + registrarEnvioComprobante(nroVta, canal, estado)
    + ObtenerEstadoTicket(nroTicket)
    + ReintentarTicket(nroTicket)
}

interface ServicioObrasSociales {
    + validarAfiliacion(obraSocialNombre, numAfiliado)
    + verificarRecetaElectronica(nroReceta)
    + registrarRecetaEnVenta(nroReceta, nroVta)
    + aplicarCoberturaVenta(nroVta, obraSocialNombre, nroReceta numAfiliado)
}

interface ServicioPagos {
    + crearPago(nroVta, tipoPago, monto, cuotas)
    + iniciarTransaccion(nroVta, numTransacción)
    + procesarRespuesta(numTransacción, estadoPago)
    + confirmarPago(nroVta, numTransacción)
    + obtenerEstadoPago(numTransacción)
    + retryTransaccion(numTransacción)
    + registrarTransaccion(nroVta, numTransacción, estadoPago)
    + validarMediosAceptados(nroVta, tipoPago, monto)
}


' ----------------- ASOCIACIONES -----------------
NegocioControlador -- Venta
NegocioControlador -- Medicamento
NegocioControlador -- Cliente
NegocioControlador -- Usuario
NegocioControlador -- Drogueria
NegocioControlador ..> ServicioPedidos
NegocioControlador ..> ServicioObrasSociales
NegocioControlador ..> ServicioPagos


ServicioPagos -- Pago

ServicioPedidos -- Drogueria
ServicioPedidos -- Pedido
ServicioPedidos -- DetallePedido
ServicioPedidos -- Ticket
ServicioPedidos -- Venta

ServicioObrasSociales -- ObraSocial
ServicioObrasSociales -- Cobertura
ServicioObrasSociales -- Receta
ServicioObrasSociales -- Venta
ServicioObrasSociales -- Cliente

@enduml