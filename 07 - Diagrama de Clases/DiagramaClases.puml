@startuml CLASES
left to right direction
skinparam linetype ortho

' ----------------- PERSONAS -----------------
class Persona {
    - nombre
    - email
    - numTel
    
    + CrearPersona(nombre, email, numTel, direccion)
    + actualizarContacto(dni, email, numTel, direccion)    
    + getNombre()
    + setNombre(nombre)
    + getEmail()
    + setEmail(email)
    + getNumTel()
    + setNumTel(numTel)
    + getDireccion()
    + setDireccion(direccion)
}

class Direccion {
    - calle
    - numero
    - localidad
    - provincia
    - cp
    
    + CrearDireccion(calle, num, loc, prov, cp)
    + getCalle()
    + setCalle()
    + getNumero()
    + setNumero()
    + getLocalidad()
    + setLocalidad()
    + getProvincia()
    + setProvincia()
    + getCp()
}

class PersonaFisica {
    - DNI
    + CrearPersonaFisica(nombre, email, tel, dir, dni)
    + getDNI()
    + setDNI(dni)
}
class PersonaJuridica {
    - CUIT
    + CrearPersonaJuridica(nombre, email, tel, dir, cuit)
    + getCUIT()
    + setCUIT(cuit)
}

Persona <|-- PersonaFisica
Persona <|-- PersonaJuridica
Persona *-- Direccion

' ----------------- USUARIO / EMPLEADO -----------------
class Usuario {
    - nombreUsuario
    - contraseña
    
    + CrearUsuario(nombreUsuario, contraseña, rol)
    + getNombreUsuario()
    + setNombreUsuario(nombreUsuario)
    + getContraseña()
    + setContraseña(contraseña)
}

class Empleado {
    ' Sin atributos repetidos (hereda nombre, dni, etc.)
    - legajo
    - sueldo

    ' Constructor completo
    + CrearEmpleado(nombre, dni, email, tel, dir, legajo, sueldo, usuario)
    + getLejago()
    + setLegajo(legajo)
    + getSueldo()
    + setSueldo(sueldo)
}

Empleado -- Usuario

enum TipoUsuario {
    Administrador
    Farmaceutico
}
Usuario -- TipoUsuario

' ----------------- ASISTENCIA -----------------
class Asistencia {
    - fecha
    - horaEntrada
    - horaSalida
    - estado

    + CrearAsistencia(usuario, fecha, horaEntrada)
    + getFecha()
    + setFecha(fecha)
    + getHoraEntrada()
    + setHoraEntrada(horaEntrada)
    + getHoraSalida()
    + setHoraSalida(horaSalida)
    + getEstado()
    + setEstado(estado)
}
enum EstadoAsistencia {
    Licencia
    Ausente
    Presente
    Tarde
}
Asistencia -- EstadoAsistencia
Empleado -- Asistencia

' ----------------- CLIENTE -----------------
class Cliente {
    ' Sin atributos repetidos
    - SaldoCtaCorriente
    - tipoCliente
    - montoAcumulado
    - esFrecuente

    + CrearCliente(dni, nombre, email, tel, dir, tipoCliente)
    
    + verificarLimiteDeuda(SaldoCtaCorriente)
    + getCliente(dni)
    + getSaldoCtaCorriente()
    + setSaldoCtaCorriente(saldo)
    + getTipoCliente()
    + setTipoCliente(tipo)
    + getMontoAcumulado()
    + setMontoAcumulado(monto)
    + getesFrecuente()
    + setesFrecuente(booleano)
    + registrarPagoCuentaCorriente(dni, monto)
}
PersonaFisica <|-- Cliente
PersonaFisica <|-- Empleado
PersonaFisica <|-- Medico

' ----------------- MEDICO / RECETA -----------------
class Medico {
    ' Sin atributos repetidos
    - matriculaMed
    
    + CrearMedico(nombre, dni, email, tel, dir, matricula)
    + getMatriculaMed()
    + setMatriculaMed(matricula)
}
class Receta {
    - nroReceta
    - fechaPrescripcion
    - fechaValidez
    - tipoReceta
    - obraSocialNombre
    
    + CrearReceta(nro, fecha, medico, cliente)
    + getNroReceta()
    + setNroReceta(nro)
    + getFechaPrescripcion()
    + setFechaPrescripcion(fecha)
    + getFechaValidez()
    + setFechaValidez(fecha)
    + getTipoReceta()
    + setTipoReceta(tipo)
    + getObraSocialNombre()
    + setObraSocialNombre(nombre)
}
class DetalleReceta {
    - fechaPrescripcion
    - productosRecetados
    
    + CrearDetalleReceta(medicamento, cantidad, indicaciones)
    + getFechaPrescripcion()
    + setFechaPrescripcion(fecha)
    + getProductosRecetados()
    + setProductosRecetados(productos)
}
Medico -- Receta
Receta *-- DetalleReceta
Cliente -- Receta

' ----------------- OBRA SOCIAL / COBERTURA -----------------
class ObraSocial {
    - nombreObraSocial
    - contacto

    + CrearObraSocial(nombre, contacto)
    + getNombreObraSocial()
    + setNombreObraSocial(nombre)
    + getContacto()
    + setContacto(contacto)
}
class Cobertura {
    - numAfiliado
    - descuentoPorcentaje
    
    + CrearCobertura(cliente, obraSocial, nroAfiliado)
    + getNumAfiliado()
    + setNumAfiliado(num)
    + getDescuentoPorcentaje()
    + setDescuentoPorcentaje(porcentaje)
}
Cliente -- Cobertura
Cobertura -- ObraSocial

' ----------------- MEDICAMENTO / DROGUERIA -----------------
class Medicamento {
    - codigoBarra
    - nombre
    - precioUnitario
    - precioDrog
    - controlado
    - stock
    - stockMinimo
    - drogueriaNombre

    + CrearMedicamento(cod, nom, precio, stock, drogueria)
    + calcularPrecioVenta()
    + disminuirStock(cantidad)
    + aumentarStock(cantidad)
    + getCodigoBarra()
    + setCodigoBarra(codigo)
    + getNombre()
    + setNombre(nombre)
    + getPrecioUnitario()
    + setPrecioUnitario(precio)
    + getControlado()
    + setControlado(booleano)
    + getCadenaFrio()
    + setCadenaFrio(booleano)
    + getStock()
    + setStock(cantidad)
    + getStockMinimo()
    + setStockMinimo(cantidad)
    + getDrogueriaNombre()
    + setDrogueriaNombre(nombre)
}
class Drogueria {
    ' Sin atributos repetidos (hereda nombre de Persona)
    - canalPreferido

    + CrearDrogueria(nombre, email, tel, dir, cuit, canalPreferido)
    + actualizarContacto(nombre, email, telefono, canalPreferido)
    + getCanalPreferido()
    + setCanalPreferido(canal)
}
PersonaJuridica <|-- Drogueria
Drogueria -- Medicamento

' ----------------- VENTAS / DETALLE / PAGO / TICKET -----------------
enum TipoVenta {
    conReceta
    sinReceta
}

enum EstadoVenta {
    Pendiente
    Concretado
    Cancelado
}

class Venta {
    - nroVta
    - fechaVenta
    - tipoVta
    - total
    - clienteDNI
    - nombreUsuario
    - estadoVenta

    + CrearVenta(nro, cliente, usuario, fecha)
    + agregarDetalle(medicamento, cantidad)
    + eliminarDetallePorCodigo(codigoBarra)
    + modificarCantidadDetalle(codigoBarra, nuevaCantidad)
    + calcularSubtotal(cantidad, precioUnitario)
    + generarNroVta()
    + calcularTotal()
    + cancelarVta()
    + getNroVta()
    + setNroVta(nro)
    + getFechaVenta()
    + setFechaVenta(fecha)
    + getTipoVta()
    + setTipoVta(tipo)
    + getTotal()
    + setTotal(total)
    + getClienteDNI()
    + setClienteDNI(dni)
    + getNombreUsuario()
    + setNombreUsuario(nombre)
    + getEstadoVenta()
    + setEstadoVenta(estado)
}
Venta ..> TipoVenta
Venta -- EstadoVenta
Venta -- Usuario

class DetalleVenta {
    - nroDetalle
    - codigoBarra
    - cantidad
    - precioUnitario
    - subtotal

    + CrearDetalleVenta(medicamento, cantidad)
    + getNroDetalle()
    + setNroDetalle(nro)
    + getCodigoBarra()
    + setCodigoBarra(codigo)
    + getCantidad()
    + setCantidad(cantidad)
    + getPrecioUnitario()
    + setPrecioUnitario(precio)
    + getSubtotal()
    + setSubtotal(subtotal)
}
Venta *-- DetalleVenta
DetalleVenta -- Medicamento

class Pago {
    - numTransacción
    - tipoPago
    - monto
    - cuotas

    + CrearPago(venta, tipo, monto, cuotas)
    + calcularRecargo(cuotas)
    + getNumTransaccion()
    + setNumTransaccion(num)
    + getTipoPago()
    + setTipoPago(tipo)
    + getMonto()
    + setMonto(monto)
    + getCuotas()
    + setCuotas(cuotas)
    + getEstado()
    + setEstado(estado)

}
Venta -- Pago

enum estadoPago {
    aprobado
    rechazado
}
Pago -- estadoPago

class Ticket {
    - nroTicket
    - fechaHora
    - pdfPath

    + CrearTicket(venta)
    + getPath()
    + getNroTicket()
    + setNroTicket(nro)
    + getFechaHora()
    + setFechaHora(fecha)
    + setPdfPath(path)
}

enum Estado {
    error
    creado
    enviado
}
Ticket -- Estado
Venta -- Ticket

' ----------------- TIPO DESCUENTO -----------------
class TipoDescuento {
    - motivo
    - porcentaje
    - fechaInicio
    - fechaFin
    - activo

    + CrearTipoDescuento(motivo, porcentaje, fechas)
    + esAplicable(nroVta)
    + getMotivo()
    + setMotivo(motivo)
    + getPorcentaje()
    + setPorcentaje(porcentaje)
    + getFechaInicio()
    + setFechaInicio(fecha)
    + getFechaFin()
    + setFechaFin(fecha)
    + getActivo()
    + setActivo(activo)
}
TipoDescuento -- Venta
TipoDescuento -- Cliente

' ----------------- PEDIDOS / DETALLEPEDIDO -----------------

class Pedido {
    - numPedido
    - proveedorNombre
    - fechaPedido

    + CrearPedido(proveedor, fecha)
    + agregarLinea(codigoBarra, cantidad)
    + modificarLinea(codigoBarra, cantidad)
    + eliminarLinea(codigoBarra)
    + calcularSubtotal(cantidad, precioUnitario)
    + generarNumPedido()
    + getNumPed()
    + setNumPed()
    + setFecha()
    + setProveedor()
    + getProveedorNombre()
    + getFechaPedido()
}

enum EstadoPedido {
    error
    creado
    enviado
}

class DetallePedido {
    - codigoBarra
    - nombreMedicamento
    - cantidad

    + CrearDetallePedido(medicamento, cantidad)
    + getCodigoBarra()
    + setCodigoBarra(codigo)
    + getNombreMedicamento()
    + setNombreMedicamento(nombre)
    + getCantidad()
    + setCantidad(cantidad)
}

Pedido *-- DetallePedido
Pedido -- Drogueria
Pedido -- EstadoPedido
DetallePedido ..> Medicamento

class GeneradorReportes {
    + generarPDF(listaDatos)
}

' ----------------- CONTROLADORES / SERVICIOS -----------------
class ControladorUsuario {
    ' Gestiona el acceso
    + iniciarSesion(nombreUsuario, contraseña)
    + cerrarSesion()
}

class GestionControlador {
    ' Gestiona el ABM de datos maestros
    
    ' Cliente: (DNI es la clave para modificar/eliminar)
    + registrarCliente(dni, nombre, email, telefono, direccion, tipoCliente)
    + modificarCliente(dni, email, telefono, direccion, tipoCliente)
    + eliminarCliente(dni)

    ' Empleado: 
    + registrarEmpleado(nombre, dni, email, direccion, legajo, sueldo, usuario, contraseña, rol)
    
    ' Asistencia
    + registrarAsistencia(nombreUsuario, fecha, horaEntrada, horaSalida, estado)

    ' Medicamento:
    + registrarMedicamento(codBarra, nombre, precioUnitario, precioDrog, stock, stockMinimo, drogueriaNombre, esControlado)
    + modificarMedicamento(codBarra, precioUnitario, stock, stockMinimo)
    + eliminarMedicamento(codBarra)

    ' Descuentos:
    + registrarTipoDescuento(motivo, porcentaje, fechaInicio, fechaFin)
    + bajaTipoDescuento(motivo)

    ' Droguería:
    + registrarDrogueria(nombre, email, telefono, direccion, cuit, canalPreferido)
    + modificarDrogueria(nombre, email, telefono, direccion, canalPreferido)
    + bajaDrogueria(nombre)
    
    ' Pedidos:
    + generarPedidoProveedor(nombreProveedor, listaProductos)

    ' Reportes:
    + solicitarInforme(tipo, filtro)
    + procesarInforme(listaDatos, accion)
}

class ControladorVentas {
    ' Orquesta la transacción
    + iniciarNuevaVenta(dniCliente)

    + validarReglasNegocio(dniCliente)

    + escanearProducto(codBarra, cantidad)
    + quitarProducto(codBarra)
    + aplicarDescuento(motivo)
    + finalizarVenta(medioPago, cuotas)
    + cancelarVenta(nroVta)
}

interface ServicioCorreos {
    ' Solo se encarga de la comunicación
    + enviarPedidoPDF(pedido, emailProveedor)
    + enviarTicketDigital(ticket, emailCliente, numtel)
    + enviarCorreo(archivoPdf, emailDestino)
}

interface ServicioObrasSociales {
    + validarAfiliacion(obraSocialNombre, numAfiliado)
    + verificarRecetaElectronica(nroReceta)
    + autorizarCobertura(nroVta, obraSocialNombre, nroReceta)
}

interface ServicioPagos {
    + procesarPago(pago)
    + confirmarTransaccion(numTransaccion)
}

' ----------------- CATÁLOGOS (SINGLETONS) -----------------
dataclass CatalogoMedicamentos <<Singleton>> {
    - listaMedicamentos: List<Medicamento>
    + agregarMedicamento(medicamento)
    + eliminarMedicamento(medicamento)
    + buscarMedicamento(codigoBarra)
    + buscarPorNombre(nombre)
    + verificarExistencia(codigoBarra)
    + buscarMedicamentos(filtro)
}

dataclass CatalogoClientes <<Singleton>> {
    - listaClientes: List<Cliente>
    + registrarCliente(cliente)
    + buscarCliente(dni)
    + existeCliente(dni)
}

dataclass CatalogoVentas <<Singleton>> {
    - listaVentas: List<Venta>
    + registrarVenta(venta)
    + buscarVenta(nroVta)
    + obtenerVentasPorFecha(fecha)
}

dataclass CatalogoDescuentos <<Singleton>>
{
    - listaDescuentos: List<TipoDescuento>
    + agregarDescuento(descuento)
    + eliminarDescuento(tipoDescuento)
    + modificarDescuento(motivo,porcentaje,fechaInicio,fechaFin)
    + obtenerDescuentosActivos()
    + buscarDescuento(motivo)
}

dataclass CatalogoProveedores <<Singleton>> {
    - listaProveedores: List<Drogueria>
    + agregarProveedor(drogueria)
    + eliminarProveedor(drogueria)
    + buscarProveedor(nombre)
}

dataclass CatalogoUsuarios <<Singleton>> {
    - listaUsuarios: List<Usuario>
    + autenticarUsuario(user, pass)
    + agregarUsuario(usuario)
    + eliminarUsuario(usuario)
    + buscarUsuario(user)
}

dataclass CatalogoAsistencia <<Singleton>>{
    - listaAsistencia: List<Asistencia>
    + agregarAsistencia(nuevaAsis)
}

' ----------------- ASOCIACIONES (REVISADAS) -----------------

' 1. Relaciones de Contenedor (Catálogo TIENE Entidades)
CatalogoMedicamentos o-- Medicamento
CatalogoProveedores o-- Drogueria
CatalogoClientes o-- Cliente
CatalogoVentas o-- Venta
CatalogoUsuarios o-- Usuario
CatalogoDescuentos o-- TipoDescuento
CatalogoAsistencia o-- Asistencia

' 2. Relaciones Controlador -> Catálogo (El cerebro usa la memoria)
ControladorUsuario --> CatalogoUsuarios
GestionControlador --> CatalogoMedicamentos
GestionControlador --> CatalogoProveedores
GestionControlador --> CatalogoClientes
GestionControlador --> CatalogoDescuentos
GestionControlador --> CatalogoAsistencia

ControladorVentas --> CatalogoVentas
ControladorVentas --> CatalogoMedicamentos
ControladorVentas --> CatalogoClientes
ControladorVentas --> CatalogoDescuentos

' 3. Relaciones Controlador -> Servicios (Uso externo)
ControladorVentas ..> ServicioPagos
ControladorVentas ..> ServicioObrasSociales
ControladorVentas ..> ServicioCorreos
GestionControlador ..> ServicioCorreos
GestionControlador ..> GeneradorReportes

' 4. Relaciones de las Entidades y Servicios (Detalles)
ServicioPagos ..> Pago
ServicioObrasSociales ..> ObraSocial
ServicioObrasSociales ..> Receta
ServicioCorreos ..> Ticket
ServicioCorreos ..> Pedido

@enduml